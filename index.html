<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#4361ee">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>PDF CUT GFander</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="fander.png" sizes="192x192">
  <link rel="apple-touch-icon" href="fander.png">
  <link rel="icon" href="fander.png" sizes="512x512">

  <!-- Fontes & Bibliotecas -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <style>
    :root{--prim:#4361ee;--success:#06d6a0;--danger:#ef476f;--gray:#f8f9fa}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#f0f4ff,#e0eafc);color:#212529;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:2rem 1rem}
    .card{background:#fff;border-radius:1.5rem;box-shadow:0 20px 40px rgba(67,97,238,.15);width:100%;max-width:560px;padding:2.5rem}
    h1{font-size:2.2rem;font-weight:700;color:var(--prim);text-align:center;margin-bottom:.5rem}
    .subtitle{text-align:center;color:#64748b;margin-bottom:2rem;font-weight:500}
    .drop{border:4px dashed var(--prim);border-radius:1rem;padding:3rem 1rem;text-align:center;cursor:pointer;background:#fff;transition:.3s}
    .drop.drag{background:var(--prim);color:#fff;border-color:#fff}
    .drop svg{width:48px;height:48px;fill:var(--prim);margin-bottom:1rem}
    .drop.drag svg{fill:#fff}
    .info{margin:1.5rem 0;padding:1rem;background:#f0f4ff;border-radius:.75rem;color:#4361ee;font-size:.95rem}
    .controls{display:grid;gap:1rem;margin:1.5rem 0}
    label{font-weight:600;color:#374151;display:block;margin-bottom:.4rem}
    input,select{padding:.75rem 1rem;border:2px solid #e2e8f0;border-radius:.75rem;font-size:1rem;width:100%;transition:.2s}
    input:focus,select:focus{border-color:var(--prim);box-shadow:0 0 0 4px rgba(67,97,238,.15);outline:none}
    .range{display:flex;gap:.5rem;align-items:center}
    .range input{width:80px;text-align:center}
    .actions{display:flex;gap:1rem;margin-top:1.5rem}
    button{flex:1;padding:.9rem;font-size:1rem;font-weight:600;border:none;border-radius:.75rem;cursor:pointer;transition:.3s}
    .btn-prim{background:var(--prim);color:#fff}
    .btn-sec{background:#e2e8f0;color:#374151}
    .btn-prim:disabled{background:#94a3b8;cursor:not-allowed}
    .progress{margin:1.5rem 0;height:12px;background:#e2e8f0;border-radius:6px;overflow:hidden;display:none}
    .bar{height:100%;width:0;background:var(--success);transition:.4s}
    .log{margin-top:1rem;padding:1rem;background:#f8f9fa;border-radius:.75rem;font-family:monospace;font-size:.9rem;max-height:180px;overflow:auto;border:1px solid #e2e8f0}
    .footer{margin-top:2rem;text-align:center;color:#94a3b8;font-size:.85rem}
    .offline{color:var(--danger);text-align:center;margin:1rem 0;font-weight:600}
    @media(max-width:480px){.card{padding:1.5rem}h1{font-size:1.8rem}}
  </style>
</head>
<body>
  <div class="card">
    <h1>PDF CUT GFander</h1>
    <p class="subtitle">100% offline • Instala no telemóvel</p>
    <div id="status" class="offline" style="display:none">OFFLINE – Tudo funciona!</div>

    <div id="drop" class="drop">
      <svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2Z"/></svg>
      <p>Arraste o PDF ou clique</p>
    </div>
    <input type="file" id="file" accept=".pdf" hidden>

    <div id="info" class="info" style="display:none">
      <strong id="nome"></strong><br>
      <span id="tamanho"></span> • <span id="paginas"></span> páginas
    </div>

    <div class="controls">
      <label>Modo</label>
      <select id="modo">
        <option value="todas">Todas</option>
        <option value="unica">Uma página</option>
        <option value="intervalo">Intervalo</option>
        <option value="lista">Lista (1,3,5-7)</option>
      </select>

      <div id="opUnica" class="range" style="display:none">
        <input type="text" id="paginaUnica" placeholder="5">
        <span>de <span id="totalUnica">0</span></span>
      </div>
      <div id="opIntervalo" class="range" style="display:none">
        <input type="text" id="de" placeholder="1"><span>até</span><input type="text" id="ate" placeholder="10">
      </div>
      <div id="opLista" style="display:none">
        <input type="text" id="lista" placeholder="1, 3, 5-8">
      </div>
    </div>

    <div class="actions">
      <button id="processar" class="btn-prim" disabled>Gerar PDFs</button>
      <button id="limpar" class="btn-sec">Limpar</button>
    </div>

    <div id="progress" class="progress"><div id="bar" class="bar"></div></div>
    <div id="log" class="log"></div>
  </div>

  <div class="footer">SPLITTER Grupo Fander © 2025 – By Manuel Nganga Ferreira</div>

  <!-- SERVICE WORKER -->
  <script>
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js')
        .then(()=>console.log('SW OK'))
        .catch(()=>console.log('SW falhou'));
    }
    window.addEventListener('offline',()=>$('#status').style.display='block');
    window.addEventListener('online',()=>$('#status').style.display='none');
  </script>

  <script>
    const $ = s => document.querySelector(s);
    const drop=$('#drop'), file=$('#file'), info=$('#info');
    const modo=$('#modo'), opUnica=$('#opUnica'), opIntervalo=$('#opIntervalo'), opLista=$('#opLista');
    const processar=$('#processar'), limpar=$('#limpar'), bar=$('#bar'), log=$('#log'), progress=$('#progress');
    let pdfDoc=null, totalPages=0, fileName='';

    drop.onclick=()=>file.click();
    file.onchange=e=>e.target.files[0]&&load(e.target.files[0]);
    drop.ondragover=drop.ondragenter=e=>{e.preventDefault();drop.classList.add('drag')};
    drop.ondragleave=drop.ondrop=e=>{e.preventDefault();drop.classList.remove('drag')};
    drop.ondrop=e=>load(e.dataTransfer.files[0]);

    modo.onchange=()=>{
      opUnica.style.display=opIntervalo.style.display=opLista.style.display='none';
      if(modo.value==='unica') opUnica.style.display='flex';
      if(modo.value==='intervalo') opIntervalo.style.display='flex';
      if(modo.value==='lista') opLista.style.display='block';
    };

    limpar.onclick=()=>{
      file.value=''; info.style.display='none'; processar.disabled=true;
      log.textContent=''; progress.style.display='none'; pdfDoc=null;
    };

    async function load(f){
      if(!f.name.toLowerCase().endsWith('.pdf')) return log.textContent='Só PDF!';
      fileName=f.name.replace(/\.pdf$/i,'');
      $('#nome').textContent=f.name;
      $('#tamanho').textContent=(f.size/1024/1024).toFixed(1)+' MB';
      log.textContent='Lendo...'; progress.style.display='block'; bar.style.width='10%';

      const buf=await f.arrayBuffer();
      pdfDoc=await PDFLib.PDFDocument.load(buf);
      totalPages=pdfDoc.getPageCount();

      $('#paginas').textContent=totalPages;
      $('#totalUnica').textContent=totalPages;
      info.style.display='block'; processar.disabled=false;
      modo.onchange();
      log.textContent=`Carregado: ${totalPages} pág(s)\nPronto!`;
      bar.style.width='30%';
    }

    processar.onclick=async()=>{
      if(!pdfDoc) return;
      log.textContent='Processando...'; progress.style.display='block'; bar.style.width='35%';
      const zip=new JSZip();
      let idxs=[];

      if(modo.value==='todas') for(let i=0;i<totalPages;i++) idxs.push(i);
      else if(modo.value==='unica'){const p=parseInt($('#paginaUnica').value)-1; if(p>=0&&p<totalPages) idxs=[p];}
      else if(modo.value==='intervalo'){
        const d=parseInt($('#de').value)-1, a=parseInt($('#ate').value)-1;
        if(d>=0&&a<totalPages&&d<=a) for(let i=d;i<=a;i++) idxs.push(i);
      }
      else if(modo.value==='lista') idxs=parsePageList($('#lista').value.trim(),totalPages);

      if(idxs.length===0){log.textContent+='\nPáginas inválidas!';return;}

      let done=0;
      for(const i of idxs){
        const novo=await PDFLib.PDFDocument.create();
        const [pag]=await novo.copyPages(pdfDoc,[i]);
        novo.addPage(pag);
        zip.file(`Página_${i+1}.pdf`, await novo.save());
        done++;
        bar.style.width=`${35+(done/idxs.length)*60}%`;
        log.textContent=`Gerando... ${done}/${idxs.length}`;
      }

      bar.style.width='98%'; log.textContent='Zipando...';
      const blob=await zip.generateAsync({type:'blob'});
      const suf=idxs.length===1?'_PÁGINA':'_PÁGINAS';
      saveAs(blob, `${fileName}${suf}.zip`);

      bar.style.width='100%';
      log.textContent+=`\nPRONTO! ${idxs.length} PDF(s)`;
      setTimeout(()=>{progress.style.display='none';},3000);
    };

    function parsePageList(t,total){
      const r=[];
      t.split(',').forEach(p=>{
        p=p.trim();
        if(p.includes('-')){
          const [a,b]=p.split('-').map(x=>parseInt(x));
          if(a&&b) for(let i=a;i<=b;i++) if(i>0&&i<=total) r.push(i-1);
        }else{
          const n=parseInt(p);
          if(n>0&&n<=total) r.push(n-1);
        }
      });
      return r;
    }
  </script>
</body>
</html>